{
    "zk_bag": "// Decompiled by SuiGPT\nmodule 0x5bb7d0bb3240011336ca9015f553b2646302a4f05f821160344e9ec5a988f740::zk_bag {\n\n    // ----- Use Statements -----\n\n    use sui::object;\n    use sui::table;\n    use sui::vec_set;\n    use sui::tx_context;\n    use sui::transfer;\n\n    // ----- Structs -----\n\n    struct BagClaim {\n        bag_id: object::ID,\n    }\n\n    struct BagStore has key {\n        id: object::UID,\n        items: table::Table<address, ZkBag>,\n    }\n\n    struct ZkBag has store, key {\n        id: object::UID,\n        owner: address,\n        item_ids: vec_set::VecSet<address>,\n    }\n\n    // ----- Functions -----\n\n    fun init(ctx: &mut tx_context::TxContext) {\n        let bagStore = BagStore {\n            id: object::new(ctx),\n            items: table::new<address, ZkBag>(ctx),\n        };\n        transfer::share_object(bagStore);\n    }\n\n    fun is_valid_claim_object(\n        zkBag: &ZkBag,\n        claim: &BagClaim\n    ): bool {\n        claim.bag_id == object::id(zkBag)\n    }\n\n    public fun new(\n        bagStore: &mut BagStore,\n        owner_address: address,\n        ctx: &mut tx_context::TxContext,\n    ) {\n        assert!(\n            !table::contains<address, ZkBag>(&bagStore.items, owner_address),\n            5\n        );\n        let zkBag = ZkBag {\n            id: object::new(ctx),\n            owner: tx_context::sender(ctx),\n            item_ids: vec_set::empty<address>(),\n        };\n        table::add<address, ZkBag>(&mut bagStore.items, owner_address, zkBag);\n    }\n\n    public fun add<T: store + key>(\n        bagStore: &mut BagStore,\n        owner_address: address,\n        item: T,\n        ctx: &mut tx_context::TxContext\n    ) {\n        assert!(table::contains<address, ZkBag>(&bagStore.items, owner_address), 6);\n        let zkBag = table::borrow_mut<address, ZkBag>(&mut bagStore.items, owner_address);\n        assert!(zkBag.owner == tx_context::sender(ctx), 1);\n        assert!(vec_set::size<address>(&zkBag.item_ids) < 50, 0);\n        vec_set::insert<address>(&mut zkBag.item_ids, object::id_address<T>(&item));\n        transfer::public_transfer(item, object::id_address<ZkBag>(zkBag));\n    }\n\n    public fun init_claim(\n        bagStore: &mut BagStore,\n        ctx: &mut tx_context::TxContext\n    ): (ZkBag, BagClaim) {\n        let sender = tx_context::sender(ctx);\n        assert!(table::contains<address, ZkBag>(&bagStore.items, sender), 6);\n        let zkBag = table::remove<address, ZkBag>(&mut bagStore.items, sender);\n        let bagClaim = BagClaim { bag_id: object::id(&zkBag) };\n        (zkBag, bagClaim)\n    }\n\n    public fun reclaim(\n        bagStore: &mut BagStore,\n        owner: address,\n        ctx: &mut tx_context::TxContext\n    ): (ZkBag, BagClaim) {\n        assert!(table::contains<address, ZkBag>(&bagStore.items, owner), 6);\n        let bag = table::remove<address, ZkBag>(&mut bagStore.items, owner);\n        assert!(bag.owner == tx_context::sender(ctx), 1);\n        let claim = BagClaim { bag_id: object::id(&bag) };\n        (bag, claim)\n    }\n\n    public fun update_receiver(\n        bagStore: &mut BagStore,\n        old_address: address,\n        new_address: address,\n        ctx: &mut tx_context::TxContext,\n    ) {\n        assert!(table::contains<address, ZkBag>(&bagStore.items, old_address), 6);\n        assert!(!table::contains<address, ZkBag>(&bagStore.items, new_address), 5);\n        let bag = table::remove<address, ZkBag>(&mut bagStore.items, old_address);\n        assert!(bag.owner == tx_context::sender(ctx), 1);\n        table::add<address, ZkBag>(&mut bagStore.items, new_address, bag);\n    }\n\n    public fun claim<T: store + key>(\n        zkBag: &mut ZkBag,\n        claim: &BagClaim,\n        receiving: transfer::Receiving<T>\n    ): T {\n        assert!(is_valid_claim_object(zkBag, claim), 2);\n        let received_object = transfer::public_receive<T>(&mut zkBag.id, receiving);\n        let object_id_address = object::id_address(&received_object);\n        assert!(vec_set::contains<address>(&zkBag.item_ids, &object_id_address), 7);\n        vec_set::remove<address>(&mut zkBag.item_ids, &object_id_address);\n        received_object\n    }\n\n    public fun finalize(\n        zkBag: ZkBag,\n        bagClaim: BagClaim\n    ) {\n        assert!(is_valid_claim_object(&zkBag, &bagClaim), 2);\n        assert!(vec_set::is_empty<address>(&zkBag.item_ids), 3);\n        \n        let ZkBag { id, owner: _, item_ids: _ } = zkBag;\n        \n        object::delete(id);\n    }\n}"
}